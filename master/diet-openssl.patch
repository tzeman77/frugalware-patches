From 3ef82030023b31aebb401e53175852b36b850d94 Mon Sep 17 00:00:00 2001
From: Tomas Zeman <tzeman@volny.cz>
Date: Tue, 30 Oct 2007 23:06:26 +0100
Subject: [PATCH] diet-openssl-0.9.8g-1-i686
 *added

---
 source/dietlibc/diet-openssl/FrugalBuild |   44 ++++++++++++++++++++++++++++++
 1 files changed, 44 insertions(+), 0 deletions(-)
 create mode 100644 source/dietlibc/diet-openssl/FrugalBuild

diff --git a/source/dietlibc/diet-openssl/FrugalBuild b/source/dietlibc/diet-openssl/FrugalBuild
new file mode 100644
index 0000000..ec2e2a5
--- /dev/null
+++ b/source/dietlibc/diet-openssl/FrugalBuild
@@ -0,0 +1,44 @@
+# Maintainer: Tomas Zeman <tzeman@volny.cz>
+
+branch=diet
+pkgorig=openssl
+pkgname=$branch-$pkgorig
+pkgver=0.9.8g
+pkgrel=1
+pkgdesc="The Open Source toolkit for Secure Sockets Layer and Transport Layer Security; dietlibc version"
+makedepends=(dietlibc gcc sed)
+url="http://www.openssl.org"
+archs=(i686)
+up2date='lynx -dump -nolist $url/source|grep $pkgorig|grep .tar.gz|head -1|sed -e "s/.*$pkgorig-\(.*\)\.tar.gz.*$/\1/"'
+source=($url/source/$pkgorig-$pkgver.tar.gz)
+sha1sums=('4e9c5ced466715d18fd924de79bde5c15da80fa1')
+
+build() {
+	DDIR=/usr/lib/diet
+	Fcd $pkgorig-$pkgver
+	
+	cp Configure Configure.orig
+#	sed -e 's/gcc:-DL_ENDIAN -DTERMIO -O3 -fomit-frame-pointer -m486 -Wall/diet gcc:-DL_ENDIAN -DTERMIO -O3 -fomit-frame-pointer -nostdinc -march=i686 -Wall/' \
+#		-e 's/gcc:-DL_ENDIAN -DTERMIO -O3 -fomit-frame-pointer -mcpu=pentium -Wall/diet gcc:-DL_ENDIAN -DTERMIO -O3 -fomit-frame-pointer -nostdinc -march=i686 -Wall/' \
+#		-e 's/gcc:-DL_ENDIAN -DTERMIO -O3 -fomit-frame-pointer -mcpu=pentiumpro -Wall/diet gcc:-DL_ENDIAN  -DTERMIO -O3 -fomit-frame-pointer -nostdinc -march=i686 -Wall/' \
+#		Configure.orig > Configure
+	sed -e 's/gcc:-DL_ENDIAN -DTERMIO -O3 -fomit-frame-pointer -Wall/diet gcc:-DL_ENDIAN -DTERMIO -O3 -fomit-frame-pointer -Wall/' \
+	-e 's/-mcpu=pentium/-march=i686/' \
+	-e 's/-mcpu=pentiumpro/-march=i686/' \
+	Configure.orig > Configure
+  
+	# no-sse to compile test sha512t
+	./config --prefix=$DDIR --openssldir=/usr/lib/diet/etc/ssl \
+		no-shared no-dso no-sse2 no-sse2
+	
+	make all || Fdie
+	make test || Fdie
+	
+	make INSTALL_PREFIX=$Fdestdir install
+	
+	Frm $DDIR/etc
+	Fmkdir $DDIR/etc
+	ln -sf /etc/ssl $Fdestdir/$DDIR/etc/ssl
+	Frm $DDIR/lib/pkgconfig
+}
+# vim: ft=sh
-- 
1.5.3.4

